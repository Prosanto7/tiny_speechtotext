define("tiny_speechtotext/commands",["exports","editor_tiny/utils","core/str","./common"],(function(_exports,_utils,_str,_common){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.getSetup=void 0;
/**
   * Commands helper for the Moodle tiny_speechtotext plugin.
   *
   * @module      tiny_speechtotext/commands
   * @copyright   2026
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
let recognition=null,listening=!1,finalTranscript="";const handleAction=editor=>{if(listening)recognition.stop(),listening=!1;else try{recognition||initializeRecognition(editor),recognition.start(),listening=!0}catch(e){window.console.error("Speech recognition start error:",e)}},initializeRecognition=editor=>{if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window))return void window.console.warn("Speech API not supported in this browser");const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;recognition=new SpeechRecognition,recognition.continuous=!0,recognition.interimResults=!0,recognition.lang=document.documentElement.lang||"en-US",recognition.onresult=event=>{let interimTranscript="";for(let i=event.resultIndex;i<event.results.length;++i){const transcript=event.results[i][0].transcript;event.results[i].isFinal?finalTranscript+=transcript+" ":interimTranscript+=transcript}finalTranscript&&(editor.insertContent(finalTranscript),finalTranscript="")},recognition.onerror=event=>{window.console.error("Speech recognition error:",event.error),listening=!1},recognition.onend=()=>{listening=!1}};_exports.getSetup=async()=>{const[buttonText,buttonImage]=await Promise.all([(0,_str.get_string)("buttontitle",_common.component),(0,_utils.getButtonImage)(_common.icon,_common.component)]);return editor=>{"webkitSpeechRecognition"in window||"SpeechRecognition"in window?(editor.ui.registry.addIcon(_common.icon,buttonImage.html),editor.ui.registry.addToggleButton(_common.buttonName,{icon:_common.icon,tooltip:buttonText,onAction:()=>handleAction(editor),onSetup:api=>{const interval=setInterval((()=>{api.setActive(listening)}),100);return()=>{clearInterval(interval)}}}),editor.ui.registry.addMenuItem(_common.buttonName,{icon:_common.icon,text:buttonText,onAction:()=>handleAction(editor)})):window.console.warn("Speech API not supported in this browser")}}}));

//# sourceMappingURL=commands.min.js.map